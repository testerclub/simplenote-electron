(window.webpackJsonp=window.webpackJsonp||[]).push([[5,7],{1268:function(e,t,n){"use strict";n.r(t),n.d(t,"NoteEditor",(function(){return De}));var o=n(0),r=n.n(o),i=n(488),a=n(1176),c=n(33),u=n(610),s=n(511),l=Object(i.b)(null,(function(e){return{openShareDialog:function(){return e(Object(s.showDialog)("SHARE"))}}}))((function(e){var t=e.openShareDialog;return r.a.createElement("div",{className:"tag-email-tooltip"},r.a.createElement("div",{className:"tag-email-tooltip__arrow"}),r.a.createElement("div",{className:"tag-email-tooltip__inside"},"Collaboration has moved. Press the Share icon in the toolbar to access the ",r.a.createElement("a",{href:"#",onClick:t},"Collaborate screen"),"."))})),d=n(37),f=n.n(d),p=function(e){var t=e.onSelect,n=e.selected,o=e.tagName;return r.a.createElement("div",{className:f()("tag-chip",{selected:n}),"data-tag-name":o,onClick:t},o)};function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=O(e);if(t){var r=O(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return S(this,n)}}function S(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?E(e):t}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(a,e);var t,n,o,i=w(a);function a(){for(var e,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return m(this,a),C(E(e=i.call.apply(i,[this].concat(n))),"inputField",void 0),C(E(e),"inputObserver",void 0),C(E(e),"state",{isComposing:!1}),C(E(e),"completeSuggestion",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.identity,n=e.props,o=n.onChange,r=n.note,i=n.tags,a=n.value;if(a.length){var u,s=null,l=g(i.values());try{for(l.s();!(u=l.n()).done;){var d=u.value;if(!r.tags.includes(d.name)&&d.name.startsWith(a)){s=d.name;break}}}catch(e){l.e(e)}finally{l.f()}s&&o(s,(function(){t(s),e.focusInput()}))}})),C(E(e),"focusInput",(function(){if(e.inputField){var t=e.inputField;t.focus();var n=document.createRange();n.selectNodeContents(t),n.collapse(!1);var o=window.getSelection();o.removeAllRanges(),o.addRange(n)}})),C(E(e),"hasFocus",(function(){return document.activeElement===e.inputField})),C(E(e),"interceptKeys",(function(t){var n;return Object(c.invoke)((C(n={},13,e.submitTag),C(n,188,e.submitTag),C(n,9,e.interceptTabPress),C(n,39,e.interceptRightArrow),n),t.keyCode,t)})),C(E(e),"interceptRightArrow",(function(t){var n=e.props.value;if(window.getSelection){var o=window.getSelection().getRangeAt(0),r=o.cloneRange();r.selectNodeContents(t.currentTarget),r.setEnd(o.endContainer,o.endOffset),r.toString().length===n.length&&(e.completeSuggestion(),t.preventDefault(),t.stopPropagation())}})),C(E(e),"interceptTabPress",(function(t){e.completeSuggestion(e.submitTag),t.preventDefault(),t.stopPropagation()})),C(E(e),"onInputMutation",(function(t){t.forEach((function(t){var n=Object(c.get)(t,"target.data","");"childList"===t.type&&t.addedNodes.length&&(n=Object(c.get)(t,"target.innerText","")),e.onInput(n)}))})),C(E(e),"onInput",(function(t){e.state.isComposing||e.props.onChange(t.trim(),e.focusInput)})),C(E(e),"onCompositionEnd",(function(t){var n=t.target.textContent;e.setState({isComposing:!1},(function(){return e.onInput(n)}))})),C(E(e),"removePastedFormatting",(function(t){var n;Object(c.get)(t,"clipboardData.getData")?n=t.clipboardData.getData("text/plain"):Object(c.get)(window,"clipboardData.getData")&&(n=window.clipboardData.getData("Text")),e.onInput(n),t.preventDefault(),t.stopPropagation()})),C(E(e),"storeInput",(function(t){e.inputField=t,e.props.inputRef(t),Object(c.invoke)(E(e),"inputField.addEventListener","paste",e.removePastedFormatting,!1)})),C(E(e),"submitTag",(function(t){var n=e.props,o=n.onSelect,r=n.value;r.trim().length&&o(r.trim()),Object(c.invoke)(t,"preventDefault"),Object(c.invoke)(t,"stopPropagation")})),e}return t=a,(n=[{key:"componentDidMount",value:function(){this.props.storeFocusInput(this.focusInput),this.props.storeHasFocus(this.hasFocus),this.inputObserver=new MutationObserver(this.onInputMutation),this.inputObserver.observe(this.inputField,{characterData:!0,childList:!0,subtree:!0})}},{key:"componentWillUnmount",value:function(){Object(c.invoke)(this,"inputField.removeEventListener","paste",this.removePastedFormatting,!1),this.inputObserver.disconnect()}},{key:"render",value:function(){var e=this,t=this.props,n=t.note,o=t.tags,i=t.value,a=null;if(i.length>0){var c,u=g(o.values());try{for(u.s();!(c=u.n()).done;){var s=c.value;if(!n.tags.includes(s.name)&&s.name.startsWith(i)){a=s.name;break}}}catch(e){u.e(e)}finally{u.f()}}var l=""===i&&!this.state.isComposing;return r.a.createElement("div",{className:"tag-input",onClick:this.focusInput},l&&r.a.createElement("span",{"aria-hidden":!0,className:"tag-input__placeholder"},"Add a tag…"),r.a.createElement("div",{"aria-label":"Add a tag…",ref:this.storeInput,className:"tag-input__entry",contentEditable:"true",onCompositionStart:function(){return e.setState({isComposing:!0})},onCompositionEnd:this.onCompositionEnd,onKeyDown:this.interceptKeys,spellCheck:!1,suppressContentEditableWarning:!0},i),r.a.createElement("div",{className:"tag-input__suggestion",disabled:!0,type:"text"},a?a.substring(i.length):""))}}])&&y(t.prototype,n),o&&y(t,o),a}(o.Component);C(k,"displayName","TagInput"),C(k,"defaultProps",{inputRef:c.identity,onChange:c.identity,onSelect:c.identity,storeFocusInput:c.noop,storeHasFocus:c.noop});var T=Object(i.b)((function(e){return{note:e.data.notes.get(e.ui.openedNote),tags:e.data.tags}}))(k),N=n(572);function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function F(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D(e);if(t){var r=D(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return L(this,n)}}function L(e,t){return!t||"object"!==x(t)&&"function"!=typeof t?R(e):t}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(d,e);var t,n,i,s=M(d);function d(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return F(this,d),A(R(e=s.call.apply(s,[this].concat(n))),"container",Object(o.createRef)()),A(R(e),"focusInput",void 0),A(R(e),"hiddenTag",void 0),A(R(e),"inputHasFocus",void 0),A(R(e),"tagInput",Object(o.createRef)()),A(R(e),"state",{selectedTag:"",showEmailTooltip:!1,tagInput:""}),A(R(e),"addTag",(function(t){var n=e.props,o=n.note,r=n.noteId,i=t.trim().replace(/\s+/g,",").split(",");i.some(u.a)&&e.showEmailTooltip();var a=new Set(o.tags.map(N.a));i.forEach((function(t){a.has(Object(N.a)(t))||(a.add(Object(N.a)(t)),e.props.addTag(r,t))})),e.storeTagInput(""),Object(c.invoke)(R(e),"tagInput.focus")})),A(R(e),"hasSelection",(function(){return e.state.selectedTag&&!!e.state.selectedTag.length})),A(R(e),"deleteTag",(function(t){var n=e.props.noteId,o=e.state.selectedTag;e.props.removeTag(n,t),o===t&&e.setState({selectedTag:""},(function(){var t,n;return null===(t=e.tagInput)||void 0===t||null===(n=t.current)||void 0===n?void 0:n.focus()}))})),A(R(e),"deleteSelection",(function(){e.hasSelection()&&e.deleteTag(e.state.selectedTag)})),A(R(e),"hideEmailTooltip",(function(){return e.setState({showEmailTooltip:!1})})),A(R(e),"hasFocus",(function(){return!!e.inputHasFocus&&e.inputHasFocus()})),A(R(e),"focusTagField",(function(){return e.focusInput&&e.focusInput()})),A(R(e),"interceptKeys",(function(t){if(8===t.which){if(e.hasSelection()&&e.deleteSelection(),""!==e.state.tagInput)return;return e.selectLastTag(),void t.preventDefault()}if(39===t.which&&e.hasSelection())return e.unselect(t),void e.focusTagField();9===t.which&&e.hasSelection()&&e.unselect(t)})),A(R(e),"preventStealingFocus",(function(t){var n=t.ctrlKey,o=t.key,r=t.metaKey,i=t.shiftKey;if(e.props.keyboardShortcuts)return(n||r)&&i&&"y"===o.toLowerCase()&&e.setState({selectedTag:""}),!0})),A(R(e),"selectLastTag",(function(){var t;return e.setState({selectedTag:null===(t=e.props.note)||void 0===t?void 0:t.tags.slice(-1).shift()})})),A(R(e),"selectTag",(function(t){var n=t.currentTarget.dataset.tagName;t.preventDefault(),t.stopPropagation(),e.deleteTag(n)})),A(R(e),"showEmailTooltip",(function(){e.setState({showEmailTooltip:!0}),setTimeout((function(){return e.setState({showEmailTooltip:!1})}),5e3)})),A(R(e),"onKeyDown",(function(t){return e.state.showEmailTooltip&&e.hideEmailTooltip(),e.interceptKeys(t)})),A(R(e),"storeFocusInput",(function(t){return e.focusInput=t})),A(R(e),"storeHasFocus",(function(t){return e.inputHasFocus=t})),A(R(e),"storeHiddenTag",(function(t){return e.hiddenTag=t})),A(R(e),"storeInputRef",(function(t){return e.tagInput=t})),A(R(e),"storeTagInput",(function(t,n){return e.setState({tagInput:t},n)})),A(R(e),"unselect",(function(t){var n;e.state.selectedTag&&(null===(n=e.hiddenTag)||void 0===n?void 0:n.current)!==t.relatedTarget&&e.setState({selectedTag:""})})),e}return t=d,(n=[{key:"componentDidMount",value:function(){this.props.storeFocusTagField(this.focusTagField),this.props.storeHasFocus(this.hasFocus),document.addEventListener("click",this.unselect,!0),window.addEventListener("keydown",this.preventStealingFocus,!0)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.unselect,!0),window.removeEventListener("keydown",this.preventStealingFocus,!0)}},{key:"componentDidUpdate",value:function(){var e,t;this.hasSelection()&&(null===(e=this.hiddenTag)||void 0===e||null===(t=e.current)||void 0===t||t.focus())}},{key:"render",value:function(){var e=this,t=this.props.note,n=this.state,o=n.selectedTag,i=n.showEmailTooltip,s=n.tagInput;return r.a.createElement("div",{ref:this.container,className:"tag-field"},r.a.createElement("div",{className:f()("tag-editor",{"has-selection":this.hasSelection()}),tabIndex:-1,onKeyDown:this.onKeyDown},r.a.createElement("input",{className:"hidden-tag",tabIndex:-1,ref:this.storeHiddenTag}),null==t?void 0:t.tags.filter(Object(c.negate)(u.a)).map((function(t){return r.a.createElement(p,{key:t,tagName:t,selected:t===o,onSelect:e.selectTag})})),r.a.createElement(T,{inputRef:this.storeInputRef,value:s,onChange:this.storeTagInput,onSelect:this.addTag,storeFocusInput:this.storeFocusInput,storeHasFocus:this.storeHasFocus}),r.a.createElement(a.a,{container:this.container.current,onHide:this.hideEmailTooltip,placement:"top",rootClose:!0,shouldUpdatePosition:!0,show:i,target:this.tagInput.current},(function(){return r.a.createElement(l,null)}))))}}])&&I(t.prototype,n),i&&I(t,i),d}(o.Component);A(P,"displayName","TagField");var _=Object(i.b)((function(e){return{allTags:e.data.tags,keyboardShortcuts:e.settings.keyboardShortcuts,noteId:e.ui.openedNote,note:e.data.notes.get(e.ui.openedNote)}}),{addTag:function(e,t){return{type:"ADD_NOTE_TAG",noteId:e,tagName:t}},removeTag:function(e,t){return{type:"REMOVE_NOTE_TAG",noteId:e,tagName:t}}})(P),K=n(895),H=n(946),W=n(501),B=n(548),U=n(560),Q=n(77),G=n(589),Y=n(649);function $(){return r.a.createElement("svg",{className:"icon-chevron-right",xmlns:"http://www.w3.org/2000/svg",width:"24px",height:"24px",viewBox:"0 0 24 24"},r.a.createElement("rect",{x:"0",fill:"none",width:"24",height:"24"}),r.a.createElement("g",null,r.a.createElement("polygon",{points:"10.11 21.19 8.7 19.78 16.48 12 8.7 4.22 10.11 2.81 19.3 12 10.11 21.19"})))}function q(e){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){ue(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function J(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],o=!0,r=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(o=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}return n}(e,t)||Z(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(e){return function(e){if(Array.isArray(e))return ee(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Z(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(e,t){if(e){if("string"==typeof e)return ee(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ee(e,t):void 0}}function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function te(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ne(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function oe(e,t){return(oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=ce(e);if(t){var r=ce(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return ie(this,n)}}function ie(e,t){return!t||"object"!==q(t)&&"function"!=typeof t?ae(e):t}function ae(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ce(e){return(ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ue(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var se=function(e){return{range:new monaco.Range(e,1,e,1),options:{isWholeLine:!0,inlineClassName:"note-title",stickiness:H.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges}}},le=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oe(e,t)}(c,e);var t,n,i,a=re(c);function c(){var e;te(this,c);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ue(ae(e=a.call.apply(a,[this].concat(n))),"bootTimer",null),ue(ae(e),"editor",null),ue(ae(e),"monaco",null),ue(ae(e),"contentDiv",Object(o.createRef)()),ue(ae(e),"decorations",[]),ue(ae(e),"matchesInNote",[]),ue(ae(e),"state",{content:"",editor:"fast",noteId:null,overTodo:!1,searchQuery:"",selectedSearchMatchIndex:null}),ue(ae(e),"toggleShortcuts",(function(t){t?window.addEventListener("keydown",e.handleShortcut,!0):window.removeEventListener("keydown",e.handleShortcut,!0)})),ue(ae(e),"handleShortcut",(function(t){var n=t.ctrlKey,o=t.metaKey,r=t.shiftKey,i=t.key.toLowerCase(),a=n||o;return a&&r&&"g"===i?(e.setPrevSearchSelection(),t.stopPropagation(),t.preventDefault(),!1):window.electron||!a||r||"g"!==i?void 0:(e.setNextSearchSelection(),t.stopPropagation(),t.preventDefault(),!1)})),ue(ae(e),"setDecorators",(function(){var t,n;e.matchesInNote=null!==(t=e.searchMatches())&&void 0!==t?t:[];var o=null!==(n=e.getTitleDecoration())&&void 0!==n?n:[];e.decorations=e.editor.deltaDecorations(e.decorations,[].concat(X(e.matchesInNote),X(o)))})),ue(ae(e),"getTitleDecoration",(function(){var t=e.editor.getModel();if(t)for(var n=1;n<=t.getLineCount();n++){if(t.getLineContent(n).trim().length>0)return[se(n)]}})),ue(ae(e),"searchMatches",(function(){if(e.editor&&e.props.searchQuery){var t=e.editor.getModel(),n=Object(U.a)(e.props.searchQuery).map((function(e){return e.normalize().toLowerCase()})).filter((function(e){return e.trim().length>0}));if(0===n.length)return[];var o=t.getValue().normalize().toLowerCase();return n.reduce((function(e,n){for(var r=null,i=0;-1!==r&&-1!==(r=o.indexOf(n,i));){i=r+n.length;var a=t.getPositionAt(r),c=t.getPositionAt(r+n.length);e.push({options:{inlineClassName:"search-decoration",overviewRuler:{color:"#3361cc",position:H.editor.OverviewRulerLane.Full}},range:{startLineNumber:a.lineNumber,startColumn:a.column,endLineNumber:c.lineNumber,endColumn:c.column}})}return e}),[])}})),ue(ae(e),"focusEditor",(function(){var t;return null===(t=e.editor)||void 0===t?void 0:t.focus()})),ue(ae(e),"hasFocus",(function(){var t;return null===(t=e.editor)||void 0===t?void 0:t.hasTextFocus()})),ue(ae(e),"handleUndoRedo",(function(t){var n,o;switch(t.inputType){case"historyUndo":return null===(n=e.editor)||void 0===n||n.trigger("browserMenu","undo",null),t.preventDefault(),void t.stopPropagation();case"historyRedo":return null===(o=e.editor)||void 0===o||o.trigger("browserMenu","redo",null),t.preventDefault(),void t.stopPropagation()}})),ue(ae(e),"cancelSelectionOrSearch",(function(t){e.props.searchQuery.length>0&&e.matchesInNote.length>0?e.props.clearSearch():t.trigger("customAction","cancelSelection",null)})),ue(ae(e),"insertOrRemoveCheckboxes",(function(t){var n,o,r=t.getModel();if(r){var i=t.getPosition();if(i){var a=i.lineNumber,c=r.getLineContent(a),u=/^(\s*)([-+*\u2022]\s*)?([\ue000\ue001]\s+)?/.exec(c);if(u){var s=J(u,4),l=(s[0],s[1]),d=s[2],f=s[3],p=void 0!==f,h=l.length+(null!==(n=null==d?void 0:d.length)&&void 0!==n?n:0)+1,g=p?"":" ",v={identifier:{major:1,minor:1},range:new e.monaco.Range(a,h,a,h+(null!==(o=null==f?void 0:f.length)&&void 0!==o?o:0)),text:g,forceMoveMarkers:!0};t.executeEdits("insertOrRemoveCheckboxes",[v]),e.props.insertTask()}}}})),ue(ae(e),"editorInit",(function(e){H.editor.defineTheme("simplenote",{base:"vs",inherit:!0,rules:[{background:"FFFFFF"}],colors:{"editor.foreground":"#2c3338","editor.background":"#ffffff","editor.selectionBackground":"#ced9f2","scrollbarSlider.activeBackground":"#8c8f94","scrollbarSlider.background":"#c3c4c7","scrollbarSlider.hoverBackground":"#a7aaad","textLink.foreground":"#1d4fc4"}}),H.editor.defineTheme("simplenote-dark",{base:"vs-dark",inherit:!0,rules:[{background:"1d2327"}],colors:{"editor.foreground":"#ffffff","editor.background":"#1d2327","editor.selectionBackground":"#50575e","scrollbarSlider.activeBackground":"#646970","scrollbarSlider.background":"#2c3338","scrollbarSlider.hoverBackground":"#1d2327","textLink.foreground":"#ced9f2"}})})),ue(ae(e),"editorReady",(function(t,n){var o,r,i;e.editor=t,e.monaco=n,n.languages.registerLinkProvider("plaintext",{provideLinks:function(e){return{links:e.findMatches("simplenote://note/[a-zA-Z0-9-]+",!0,!0,!1,null,!1).map((function(e){return{range:e.range}}))}},resolveLink:function(n){var o,r,i=null!==(o=null===(r=t.getModel())||void 0===r?void 0:r.getValueInRange(n.range))&&void 0!==o?o:"",a=/^simplenote:\/\/note\/(.+)$/.exec(i);if(a){var c=J(a,2),u=(c[0],c[1]);return e.props.notes.has(u)&&e.props.openNote(u),V(V({},n),{},{url:"#"})}}});var a=["cancelSelection","cursorUndo","editor.action.commentLine","editor.action.jumpToBracket","editor.action.transposeLetters","editor.action.triggerSuggest","expandLineSelection","editor.action.gotoLine","actions.find","actions.findWithSelection","editor.action.addSelectionToNextFindMatch","editor.action.nextMatchFindAction","editor.action.selectHighlights"];window.electron&&a.push("undo","redo","editor.action.selectAll"),a.forEach((function(e){t._standaloneKeybindingService.addDynamicKeybinding("-"+e)})),t.createContextKey("allowBrowserKeybinding",!window.electron),t.addAction({id:"context_undo",label:"Undo",keybindings:[n.KeyMod.CtrlCmd|n.KeyCode.KEY_Z],keybindingContext:"allowBrowserKeybinding",contextMenuGroupId:"1_modification",contextMenuOrder:2,run:function(){t.trigger("contextMenu","undo",null)}}),t.addAction({id:"context_redo",label:"Redo",keybindings:[n.KeyMod.WinCtrl|n.KeyCode.KEY_Y,n.KeyMod.CtrlCmd|n.KeyMod.Shift|n.KeyCode.KEY_Z],keybindingContext:"allowBrowserKeybinding",contextMenuGroupId:"1_modification",contextMenuOrder:3,run:function(){t.trigger("contextMenu","redo",null)}}),t.addAction({id:"context_cut",label:"Cut",keybindings:[n.KeyMod.CtrlCmd|n.KeyCode.KEY_X],keybindingContext:"allowBrowserKeybinding",contextMenuGroupId:"9_cutcopypaste",contextMenuOrder:1,run:function(){t.trigger("contextMenu","editor.action.clipboardCutAction",null)}}),t.addAction({id:"context_copy",label:"Copy",keybindings:[n.KeyMod.CtrlCmd|n.KeyCode.KEY_C],keybindingContext:"allowBrowserKeybinding",contextMenuGroupId:"9_cutcopypaste",contextMenuOrder:2,run:function(){t.trigger("contextMenu","editor.action.clipboardCopyAction",null)}}),t.addAction({id:"cancel_selection",label:"Cancel Selection",keybindings:[n.KeyCode.Escape],run:e.cancelSelectionOrSearch}),window.electron&&t.addAction({id:"paste",label:"Paste",contextMenuGroupId:"9_cutcopypaste",contextMenuOrder:3,keybindings:[n.KeyMod.CtrlCmd|n.KeyCode.KEY_V],keybindingContext:"allowBrowserKeybinding",run:function(){document.execCommand("paste")}}),t.addAction({id:"select_all",label:"Select All",contextMenuGroupId:"9_cutcopypaste",contextMenuOrder:4,keybindings:[n.KeyMod.CtrlCmd|n.KeyCode.KEY_A],keybindingContext:"allowBrowserKeybinding",run:function(){t.setSelection(t.getModel().getFullModelRange())}}),t.addAction({id:"insertChecklist",label:"Insert Checklist",keybindings:[n.KeyMod.CtrlCmd|n.KeyMod.Shift|n.KeyCode.KEY_C],keybindingContext:"allowBrowserKeybinding",contextMenuGroupId:"10_checklist",contextMenuOrder:1,run:e.insertOrRemoveCheckboxes}),null===(o=window.electron)||void 0===o||o.receive("editorCommand",(function(n){switch(n.action){case"findAgain":return void e.setNextSearchSelection();case"insertChecklist":return void t.trigger("editorCommand","insertChecklist",null);case"redo":return void(t.hasTextFocus()?t.trigger("editorCommand","redo",null):document.execCommand("redo"));case"selectAll":return void(t.hasTextFocus()?t.setSelection(t.getModel().getFullModelRange()):document.execCommand("selectAll"));case"undo":return void(t.hasTextFocus()?t.trigger("editorCommand","undo",null):document.execCommand("undo"))}})),window.electron||window.addEventListener("input",e.handleUndoRedo,!0),e.setDecorators(),e.setState({}),t.onDidChangeModelContent((function(){return e.setDecorators()})),document.oncopy=function(e){e.clipboardData.setData("text/plain",Object(G.b)(e.clipboardData.getData("text/plain")))};var c=J(e.props.editorSelection,3),u=c[0],s=c[1],l=c[2],d=null===(r=e.editor.getModel())||void 0===r?void 0:r.getPositionAt(u),f=null===(i=e.editor.getModel())||void 0===i?void 0:i.getPositionAt(s);e.editor.setSelection(H.Selection.createWithDirection(null==d?void 0:d.lineNumber,null==d?void 0:d.column,null==f?void 0:f.lineNumber,null==f?void 0:f.column,"RTL"===l?H.SelectionDirection.RTL:H.SelectionDirection.LTR)),t.revealLine(d.lineNumber,H.editor.ScrollType.Immediate),t.onDidChangeCursorSelection((function(n){var o,r;if(n.reason!==H.editor.CursorChangeReason.Undo&&n.reason!==H.editor.CursorChangeReason.Redo){var i=null===(o=t.getModel())||void 0===o?void 0:o.getOffsetAt(n.selection.getStartPosition()),a=null===(r=t.getModel())||void 0===r?void 0:r.getOffsetAt(n.selection.getEndPosition()),c=n.selection.getDirection()===H.SelectionDirection.LTR?"LTR":"RTL";e.props.storeEditorSelection(e.props.noteId,i,a,c)}})),t.onMouseMove((function(n){var o=e.state.content,r=n.target.range;if(r&&!(r.endColumn-r.startColumn>1)){var i=t.getModel();if(i){var a=i.getOffsetAt({lineNumber:r.startLineNumber,column:r.startColumn}),c=""===o[a]||""===o[a];e.state.overTodo!==c&&e.setState({overTodo:c})}}})),t.onMouseDown((function(n){var o=e.props,r=o.editNote,i=o.noteId,a=e.state.content,c=n.target.range;if(c&&!(c.endColumn-c.startColumn>1)){var u=t.getModel();if(u){var s=u.getOffsetAt({lineNumber:c.startLineNumber,column:c.startColumn});""===a[s]?r(i,{content:Object(G.b)(a.slice(0,s)+""+a.slice(s+1))}):""===a[s]&&r(i,{content:Object(G.b)(a.slice(0,s)+""+a.slice(s+1))})}}}))})),ue(ae(e),"updateNote",(function(t,n){var o=e.props,r=o.editNote,i=o.noteId;if(e.editor){var a=function(){if(e.editor&&!n.isRedoing&&!n.isUndoing){var o=n.changes.find((function(e){var t=e.text;return"\n"===t[0]&&""===t.trim()}));if(o){var r=o.range.startLineNumber;if(0!==r&&r===o.range.endLineNumber){var i=e.editor.getModel(),a=i.getLineContent(r),c=/^(\s*)([-+*\u2022\ue000\ue001])(\s+)/.exec(a);if(null!==c){var u=i.getLineContent(r+1);if(/^\s*$/.test(u)){if(0===u.trim().length&&a.length===c[0].length){var s=i.getOffsetAt({column:0,lineNumber:r}),l=i.getOffsetAt({column:0,lineNumber:r+1}),d={identifier:{major:1,minor:1},range:new e.monaco.Range(r,0,r+1,0),text:"",forceMoveMarkers:!0};return e.editor.executeEdits("autolist",[d]),t.slice(0,Math.max(0,s-1))+t.slice(l)}var f=i.getOffsetAt({column:0,lineNumber:r+1}),p=i.getOffsetAt({column:0,lineNumber:r+2}),h={identifier:{major:1,minor:1},range:new e.monaco.Range(r+1,0,r+1,u.length),text:c[0].replace("",""),forceMoveMarkers:!0};return e.editor.executeEdits("autolist",[h]),Promise.resolve().then((function(){return e.editor.setPosition({column:c[0].length+1,lineNumber:r+1})})),t.slice(0,f)+c[0].replace("","")+n.eol+t.slice(p)}}}}}}()||t;r(i,{content:Object(G.b)(a)})}})),ue(ae(e),"setNextSearchSelection",(function(){var t=e.state.selectedSearchMatchIndex,n=e.matchesInNote.length,o=(n+(null!=t?t:-1)+1)%n;e.setSearchSelection(o)})),ue(ae(e),"setPrevSearchSelection",(function(){var t=e.state.selectedSearchMatchIndex,n=e.matchesInNote.length,o=(n+(null!=t?t:n)-1)%n;e.setSearchSelection(o)})),ue(ae(e),"setSearchSelection",(function(t){if(e.matchesInNote.length){var n=e.matchesInNote[t].range;e.setState({selectedSearchMatchIndex:t}),e.editor.setSelection(n),e.editor.revealLineInCenter(n.startLineNumber),e.focusEditor()}})),e}return t=c,i=[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.note.content.length>5e3,o=e.note.content!==t.content,r=e.noteId!==t.noteId,i=o?r&&n?e.note.content.slice(0,e.editorSelection[1]+5e3):Object(G.a)(e.note.content):t.content,a=r?n?"fast":"full":t.editor,c=e.searchQuery!==t.searchQuery,u=r||c?null:t.selectedSearchMatchIndex;return{content:i,editor:a,noteId:e.noteId,searchQuery:e.searchQuery,selectedSearchMatchIndex:u}}}],(n=[{key:"componentDidMount",value:function(){var e=this,t=this.props.noteId;this.bootTimer=setTimeout((function(){t===e.props.noteId&&e.setState({editor:"full",content:Object(G.a)(e.props.note.content)})}),120),this.props.storeFocusEditor(this.focusEditor),this.props.storeHasFocus(this.hasFocus),this.toggleShortcuts(!0)}},{key:"componentWillUnmount",value:function(){var e;this.bootTimer&&clearTimeout(this.bootTimer),null===(e=window.electron)||void 0===e||e.removeListener("editorCommand"),window.removeEventListener("input",this.handleUndoRedo,!0),this.toggleShortcuts(!1)}},{key:"componentDidUpdate",value:function(e){var t,n=this,o=J(e.editorSelection,3),r=o[0],i=o[1],a=o[2],c=J(this.props.editorSelection,3),u=c[0],s=c[1],l=c[2];if(this.editor&&"full"===this.state.editor&&(r!==u||i!==s||a!==l)){var d,f,p=null===(d=this.editor.getModel())||void 0===d?void 0:d.getPositionAt(u),h=null===(f=this.editor.getModel())||void 0===f?void 0:f.getPositionAt(s);this.editor.setSelection(H.Selection.createWithDirection(null==p?void 0:p.lineNumber,null==p?void 0:p.column,null==h?void 0:h.lineNumber,null==h?void 0:h.column,"RTL"===l?H.SelectionDirection.RTL:H.SelectionDirection.LTR))}""===this.props.searchQuery&&""!==e.searchQuery&&(null===(t=this.editor)||void 0===t||t.setSelection(new this.monaco.Range(0,0,0,0))),this.props.lineLength===e.lineLength&&this.props.isFocusMode===e.isFocusMode||setTimeout((function(){n.editor&&n.editor.layout()}),400),this.editor&&"full"===this.state.editor&&e.searchQuery!==this.props.searchQuery&&this.setDecorators()}},{key:"render",value:function(){var e,t=this.props,n=t.lineLength,o=t.noteId,i=t.searchQuery,a=t.theme,c=this.state,u=c.content,s=c.editor,l=c.overTodo,d=c.selectedSearchMatchIndex,f=i?this.searchMatches():[],p=function(e,t){return"full"===e||void 0===t?25:t<=1072?.1*t:(t-768)/2}(n,null===(e=this.contentDiv.current)||void 0===e?void 0:e.offsetWidth);return r.a.createElement("div",{ref:this.contentDiv,className:"note-content-editor-shell".concat(l?" cursor-pointer":"")},r.a.createElement("div",{className:"note-content-plaintext".concat("fast"===s?" visible":"")},u),"fast"!==s&&r.a.createElement(K.default,{key:o,editorDidMount:this.editorReady,editorWillMount:this.editorInit,language:"plaintext",theme:"dark"===a?"simplenote-dark":"simplenote",onChange:this.updateNote,options:{autoClosingBrackets:"never",autoClosingQuotes:"never",autoIndent:"keep",autoSurround:"never",automaticLayout:!0,codeLens:!1,folding:!1,fontFamily:'"Simplenote Tasks", -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen-Sans", "Ubuntu", "Cantarell", "Helvetica Neue", sans-serif',hideCursorInOverviewRuler:!0,lineDecorationsWidth:p,fontSize:16,lineHeight:24,lineNumbers:"off",links:!0,matchBrackets:"never",minimap:{enabled:!1},occurrencesHighlight:!1,overviewRulerBorder:!1,quickSuggestions:!1,renderIndentGuides:!1,renderLineHighlight:"none",scrollbar:{horizontal:"hidden",useShadows:!1,verticalScrollbarSize:p},scrollBeyondLastLine:!1,selectionHighlight:!1,wordWrap:"bounded",wrappingStrategy:Q.c?"simple":"advanced",wordWrapColumn:400},value:u}),i.length>0&&f&&r.a.createElement("div",{className:"search-results"},r.a.createElement("div",null,null===d?"".concat(f.length," Results"):"".concat(d+1," of ").concat(f.length)),r.a.createElement("span",{className:"search-results-next"},r.a.createElement(Y.a,{disabled:f.length<=1,icon:r.a.createElement($,null),onClick:this.setNextSearchSelection,title:"Next"})),r.a.createElement("span",{className:"search-results-prev"},r.a.createElement(Y.a,{disabled:f.length<=1,icon:r.a.createElement($,null),onClick:this.setPrevSearchSelection,title:"Prev"}))))}}])&&ne(t.prototype,n),i&&ne(t,i),c}(o.Component),de={clearSearch:function(){return dispatch(Object(s.search)(""))},editNote:W.a.data.editNote,insertTask:function(){return{type:"INSERT_TASK"}},openNote:W.a.ui.selectNote,storeEditorSelection:function(e,t,n,o){return{type:"STORE_EDITOR_SELECTION",noteId:e,start:t,end:n,direction:o}}},fe=Object(i.b)((function(e){var t;return{editorSelection:null!==(t=e.ui.editorSelection.get(e.ui.openedNote))&&void 0!==t?t:[0,0,"LTR"],isFocusMode:e.settings.focusModeEnabled,keyboardShortcuts:e.settings.keyboardShortcuts,lineLength:e.settings.lineLength,noteId:e.ui.openedNote,note:e.data.notes.get(e.ui.openedNote),notes:e.data.notes,searchQuery:e.ui.searchQuery,spellCheckEnabled:e.settings.spellCheckEnabled,theme:B.a(e)}}),de)(le),pe=n(650);function he(e){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ge(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ve(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function me(e,t){return(me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ye(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Se(e);if(t){var r=Se(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return be(this,n)}}function be(e,t){return!t||"object"!==he(t)&&"function"!=typeof t?we(e):t}function we(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Se(e){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Oe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&me(e,t)}(a,e);var t,n,o,i=ye(a);function a(){var e;ge(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return Ee(we(e=i.call.apply(i,[this].concat(n))),"focusEditor",(function(){return e.focusContentEditor&&e.focusContentEditor()})),Ee(we(e),"hasFocus",(function(){var t,n;return null===(t=(n=e).editorHasFocus)||void 0===t?void 0:t.call(n)})),Ee(we(e),"storeEditorHasFocus",(function(t){return e.editorHasFocus=t})),Ee(we(e),"storeFocusContentEditor",(function(t){return e.focusContentEditor=t})),e}return t=a,(n=[{key:"componentDidMount",value:function(){this.props.storeFocusEditor(this.focusEditor),this.props.storeHasFocus(this.hasFocus)}},{key:"render",value:function(){var e=this.props.openedNote;return r.a.createElement("div",{className:"note-detail-wrapper"},e?r.a.createElement(fe,{key:e,storeFocusEditor:this.storeFocusContentEditor,storeHasFocus:this.storeEditorHasFocus}):r.a.createElement("div",{className:"note-detail-placeholder"},r.a.createElement(pe.a,null)))}}])&&ve(t.prototype,n),o&&ve(t,o),a}(o.Component);Ee(Oe,"displayName","NoteDetail");var Ce=Object(i.b)((function(e){return{isDialogOpen:e.ui.dialogs.length>0,keyboardShortcuts:e.settings.keyboardShortcuts,openedNote:e.ui.openedNote}}))(Oe),ke=n(792);function Te(e){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Fe(e,t){return(Fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Le(e);if(t){var r=Le(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return je(this,n)}}function je(e,t){return!t||"object"!==Te(t)&&"function"!=typeof t?Me(e):t}function Me(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Le(e){return(Le=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var De=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fe(e,t)}(a,e);var t,n,o,i=Ie(a);function a(){var e;Ne(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return Re(Me(e=i.call.apply(i,[this].concat(n))),"markdownEnabled",(function(){var t;return null===(t=e.props.note)||void 0===t?void 0:t.systemTags.includes("markdown")})),Re(Me(e),"handleShortcut",(function(t){if(e.props.keyboardShortcuts){var n,o,r,i,a=t.ctrlKey,c=t.metaKey,u=t.shiftKey,s=t.key.toLowerCase(),l=e.props,d=l.note,f=l.noteId,p=l.toggleMarkdown,h=a||c;return d&&h&&u&&"m"===s?(p(f,!e.markdownEnabled()),t.stopPropagation(),t.preventDefault(),!1):h&&u&&"p"===s&&e.markdownEnabled()?(e.props.toggleEditMode(),t.stopPropagation(),t.preventDefault(),!1):!(u&&h&&"y"===s&&e.props.isEditorActive)||(!e.editFieldHasFocus()||e.props.isSearchActive?(null===(n=(o=e).focusNoteEditor)||void 0===n||n.call(o),t.stopPropagation(),t.preventDefault(),!1):(null===(r=(i=e).focusTagField)||void 0===r||r.call(i),t.stopPropagation(),t.preventDefault(),!1))}})),Re(Me(e),"editFieldHasFocus",(function(){return e.editorHasFocus&&e.editorHasFocus()})),Re(Me(e),"storeEditorHasFocus",(function(t){return e.editorHasFocus=t})),Re(Me(e),"storeFocusEditor",(function(t){return e.focusNoteEditor=t})),Re(Me(e),"storeFocusTagField",(function(t){return e.focusTagField=t})),Re(Me(e),"storeTagFieldHasFocus",(function(t){return e.tagFieldHasFocus=t})),Re(Me(e),"tagFieldHasFocus",(function(){return e.tagFieldHasFocus&&e.tagFieldHasFocus()})),Re(Me(e),"toggleShortcuts",(function(t){t?window.addEventListener("keydown",e.handleShortcut,!0):window.removeEventListener("keydown",e.handleShortcut,!0)})),e}return t=a,(n=[{key:"componentDidMount",value:function(){this.toggleShortcuts(!0)}},{key:"componentWillUnmount",value:function(){this.toggleShortcuts(!1)}},{key:"render",value:function(){var e=this.props,t=e.editMode,n=e.note,o=e.noteId;if(!n)return r.a.createElement("div",{className:"note-detail-placeholder"},r.a.createElement(pe.a,null));var i=!!n.deleted;return r.a.createElement("div",{className:"note-editor theme-color-bg theme-color-fg"},t||!n.systemTags.includes("markdown")?r.a.createElement(Ce,{storeFocusEditor:this.storeFocusEditor,storeHasFocus:this.storeEditorHasFocus}):r.a.createElement(ke.default,{noteId:o}),n&&!i&&r.a.createElement(_,{storeFocusTagField:this.storeFocusTagField,storeHasFocus:this.storeTagFieldHasFocus}))}}])&&xe(t.prototype,n),o&&xe(t,o),a}(o.Component);Re(De,"displayName","NoteEditor");var Ae={toggleNoteList:W.a.ui.toggleNoteList,toggleMarkdown:W.a.data.markdownNote,toggleEditMode:W.a.ui.toggleEditMode};t.default=Object(i.b)((function(e){return{allTags:e.data.tags,editMode:e.ui.editMode,keyboardShortcuts:e.settings.keyboardShortcuts,isEditorActive:!e.ui.showNavigation,noteId:e.ui.openedNote,note:e.data.notes.get(e.ui.openedNote),revision:e.ui.selectedRevision,isSearchActive:!!e.ui.searchQuery.length,isSmallScreen:B.b(e)}}),Ae)(De)},792:function(e,t,n){"use strict";n.r(t),n.d(t,"NotePreview",(function(){return S}));var o=n(0),r=n.n(o),i=n(488),a=n(560),c=n(787),u=n.n(c),s=n(788),l=n.n(s),d=n(33),f={type:"output",regex:'<input type="checkbox" disabled',replace:'<input type="checkbox" '},p=function(e){return n.e(18).then(n.t.bind(null,1262,7)).then((function(t){var n=t.default;n.extension("enableCheckboxes",f);var o=new n.Converter({extensions:["enableCheckboxes"]});o.setFlavor("github"),o.setOption("simpleLineBreaks",!1),o.setOption("ghMentions",!1),o.setOption("smoothLivePreview",!0),o.setOption("tables",!0),o.setOption("strikethrough",!0);var r=e.replace(/([ \t\u2000-\u200a]*)\u2022(\s)/gm,"$1-$2");return function(e){for(var t=(new DOMParser).parseFromString(e,"text/html"),n=t.createTreeWalker(t.body,NodeFilter.SHOW_ALL,null,!1),o=[],r=[],i=function(){var e=n.currentNode;if(function(e){switch(e.nodeName.toLowerCase()){case"head":case"html":case"iframe":case"link":case"meta":case"object":case"script":case"style":return!0;default:return!1}}(e))return r.push(e),"continue";if(!function(e){var t=e.nodeName.toLowerCase();if("input"===t)return"checkbox"===e.getAttribute("type");switch(t){case"#text":case"a":case"article":case"b":case"br":case"blockquote":case"cite":case"code":case"dd":case"del":case"div":case"dt":case"em":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"hr":case"i":case"img":case"ins":case"kbd":case"li":case"ol":case"p":case"pre":case"s":case"span":case"strong":case"sub":case"sup":case"table":case"tbody":case"td":case"th":case"thead":case"tr":case"tt":case"ul":return!0;default:return!1}}(e))return o.push(e),"continue";var t=e.nodeName.toLowerCase();Object(d.filter)(e.attributes,(function(e){var n=e.name,o=e.value;return!function(e,t,n){switch(e){case"a":switch(t){case"href":return!n.toLowerCase().trim().startsWith("javascript");case"alt":case"rel":case"title":return!0;default:return!1}case"img":switch(t){case"alt":case"src":case"title":case"width":return!0;default:return!1}case"input":switch(t){case"disabled":case"checked":case"type":return!0;default:return!1}case"li":switch(t){case"class":switch(n){case"task-list-item":return!0;default:return!1}default:return!1}case"ol":switch(t){case"start":return!0;default:return!1}case"th":case"td":switch(t){case"style":switch(n){case"text-align:center;":case"text-align:left;":case"text-align:right;":return!0;default:return!1}default:return!1}default:return!1}}(t,n,o)&&(("href"!==n&&"src"!==n||!l.a.isWebUri(o))&&("href"!==n||!o.startsWith("mailto:")||!u.a.validate(o.slice(7))))})).forEach((function(t){var n=t.name;return e.removeAttribute(n)}));var i="a"===t&&e.getAttribute("href");"a"!==t||"string"!=typeof i||i.startsWith("mailto:")||(e.setAttribute("target","_blank"),e.setAttribute("rel","external noopener noreferrer")),"li"===t&&"task-list-item"===e.getAttribute("class")&&e.setAttribute("style","list-style: none;")};n.nextNode();)i();return r.forEach((function(e){try{var t;null==e||null===(t=e.parentNode)||void 0===t||t.removeChild(e)}catch(e){}})),o.forEach((function(e){var t,n=e.parentNode;try{for(;t=e.firstChild;)null==n||n.insertBefore(t,e);null==n||n.removeChild(e)}catch(e){}})),t.body.innerHTML}(o.makeHtml(r))}))},h=function(e,t,o){return p(t).then((function(t){return e.innerHTML=t,e})).then((function(e){if(!o)return e.querySelectorAll("pre code");var t=Object(a.a)(o).map((function(e){return e.toLocaleLowerCase()}));if(!t.length)return e.querySelectorAll("pre code");for(var n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return t.some((function(t){var n;return null===(n=e.textContent)||void 0===n?void 0:n.toLocaleLowerCase().includes(t)}))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},!1),r=[],i=n.currentNode;i;)r.push(i),i=n.nextNode();return r.forEach((function(e){return function e(t,n){var o=t.parentNode;n.forEach((function(t){o.childNodes.forEach((function(o){var r,i,a;if(o.nodeType===Node.TEXT_NODE&&(null===(r=o.textContent)||void 0===r?void 0:r.toLocaleLowerCase().includes(t))){var c=null===(i=o.textContent)||void 0===i?void 0:i.toLocaleLowerCase().indexOf(t),u=o.splitText(c),s=u.splitText(t.length),l=document.createElement("span");l.setAttribute("class","search-match"),null===(a=u.parentNode)||void 0===a||a.replaceChild(l,u),l.appendChild(u),e(s,n)}}))}))}(e,t)})),e.querySelectorAll("pre code")})).then((function(e){if(e.length)return n.e(13).then(n.t.bind(null,1261,7)).then((function(t){var n=t.default;e.forEach(n.highlightBlock)})).catch()}))},g=n(133),v=n(589),m=n(501);function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],o=!0,r=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(o=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var S=function(e){var t,n=e.editNote,i=e.isFocused,a=e.note,c=e.noteId,u=e.notes,s=e.openNote,l=e.searchQuery,d=e.showRenderedView,f=Object(o.useRef)();return Object(o.useEffect)((function(){var e=function(e){if(!i)return!0;if(!document.getSelection().isCollapsed)return!0;var t=document.createElement("div");h(t,a.content,l).then((function(){try{e.clipboardData.setData("text/plain",t.innerHTML)}catch(e){navigator.clipboard.writeText(t.innerHTML)}})),e.preventDefault()};return document.addEventListener("copy",e,!1),function(){return document.removeEventListener("copy",e,!1)}}),[i,l]),Object(o.useEffect)((function(){var e,t=function(e){for(var t=e.target;null!==t;t=t.parentNode){if("A"===t.tagName){e.preventDefault(),e.stopPropagation();var o=t;if(o.href.startsWith("simplenote://note/")){var r=/^simplenote:\/\/note\/(.+)$/.exec(o.href);if(!r)return;var i=b(r,2),l=(i[0],i[1]);return void(u.has(l)&&s(l))}return void(o.href.startsWith("http://localhost")||Object(g.a)(o.href))}if("task-list-item"===t.className){var d=function(){e.preventDefault(),e.stopPropagation();var o=f.current.querySelectorAll("[data-markdown-root] .task-list-item"),r=Array.prototype.indexOf.call(o,t),i=0,u=a.content.replace(/(- \[x\]|- \[ \])/g,(function(e){return i++===r?"- [ ]"===e?"- [x]":"- [ ]":e}));return n(c,{content:u}),{v:void 0}}();if("object"===y(d))return d.v}}};return null===(e=f.current)||void 0===e||e.addEventListener("click",t,!0),function(){var e;return null===(e=f.current)||void 0===e?void 0:e.removeEventListener("click",t,!0)}}),[a]),Object(o.useEffect)((function(){var e;f.current&&((null==a?void 0:a.content)&&d?h(f.current,a.content,l):f.current.innerText=Object(v.a)(null!==(e=null==a?void 0:a.content)&&void 0!==e?e:""))}),[null==a?void 0:a.content,l,d]),r.a.createElement("div",{className:"note-detail-wrapper"},r.a.createElement("div",{className:"note-detail note-detail-preview"},r.a.createElement("div",{ref:f,className:"note-detail-markdown theme-color-bg theme-color-fg","data-markdown-root":!0},r.a.createElement("div",{style:{whiteSpace:"pre"}},!d&&Object(v.a)(null!==(t=null==a?void 0:a.content)&&void 0!==t?t:"")))))},E={editNote:m.a.data.editNote,openNote:m.a.ui.selectNote};t.default=Object(i.b)((function(e,t){var n,o,r=null!==(n=t.noteId)&&void 0!==n?n:e.ui.openedNote,i=null!==(o=t.note)&&void 0!==o?o:e.data.notes.get(r);return{isFocused:0===e.ui.dialogs.length&&!e.ui.showNoteInfo,note:i,noteId:r,notes:e.data.notes,searchQuery:e.ui.searchQuery,showRenderedView:!!(null==i?void 0:i.systemTags.includes("markdown"))&&!e.ui.editMode}}),E)(S)}}]);